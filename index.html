<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Gestor de Campeonatos Escolares</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <script type="module" src="https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js"></script>
  <script type="module" src="https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore.js"></script>
  <style>
    :root{
      --blue-dark:#002F6C;
      --blue-mid:#005EB8;
      --white:#FFFFFF;
      --green:#78BE20;
      --yellow:#FFD100;
      --muted:#6b7280;
    }
    body { font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background:#f3f4f6; color:#111827; }
    .sidebar { width:260px; background:var(--blue-dark); color:var(--white); min-height:100vh; padding:20px; }
    .nav-item { padding:10px 12px; border-radius:8px; cursor:pointer; margin-bottom:8px; display:flex; align-items:center; gap:8px; }
    .nav-item:hover { background:var(--blue-mid); }
    .btn { padding:10px 14px; border-radius:8px; font-weight:600; cursor:pointer; }
    .btn-primary { background:var(--blue-dark); color:var(--white); }
    .btn-primary:hover { background:var(--blue-mid); }
    .btn-accent { background:var(--green); color:var(--white); }
    .card { background:#fff; border-radius:12px; padding:18px; box-shadow:0 6px 18px rgba(2,6,23,0.06); }
    .label-muted { color:var(--muted); font-size:0.9rem; }
    .topbar { background:var(--white); padding:12px 18px; display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #e5e7eb; }
    .logo { height:56px; }
    .input { padding:8px 10px; border-radius:8px; border:1px solid #d1d5db; }
    .muted-btn { background:#f3f4f6; color:#374151; border:1px solid #e5e7eb; }
  </style>
</head>
<body>

  <!-- LOGIN -->
  <div id="loginScreen" class="min-h-screen flex items-center justify-center">
    <div class="card w-full max-w-md">
      <div class="flex flex-col items-center gap-3">
        <img src="https://i.imgur.com/k4LX9l8.jpeg" alt="Logo" class="logo" />
        <h1 class="text-2xl font-bold">Championship Manager</h1>
        <p class="label-muted text-center">Manage school championships — admin, teachers and visitors.</p>
      </div>

      <div class="mt-6 space-y-3">
        <div>
          <label class="small">Username</label>
          <input id="usernameInput" class="input w-full mt-1" placeholder="admin or professor name" />
        </div>
        <div>
          <label class="small">Password</label>
          <input id="passwordInput" type="password" class="input w-full mt-1" placeholder="password" />
        </div>
        <div>
          <label class="small">Profile</label>
          <select id="profileSelect" class="input w-full mt-1">
            <option value="admin">Administrator</option>
            <option value="professor">Teacher</option>
          </select>
        </div>
        <div class="flex gap-2 mt-3">
          <button id="loginBtn" class="btn btn-primary flex-1">Sign In</button>
          <button id="visitorBtn" class="btn muted-btn flex-1">Continue as Visitor</button>
        </div>
      </div>
    </div>
  </div>

  <!-- APP -->
  <div id="mainApp" class="hidden flex">
    <aside class="sidebar">
      <div class="flex flex-col items-center mb-6">
        <img src="https://i.imgur.com/k4LX9l8.jpeg" alt="logo" style="height:72px;"/>
        <h3 class="mt-2 font-bold text-white text-center">Copa das Escolas</h3>
      </div>
      <div id="navMenu"></div>
      <div style="margin-top:auto">
        <button id="logoutBtn" class="btn" style="width:100%; background:#ef4444; color:white;">Logout</button>
      </div>
    </aside>
    <main style="flex:1; padding:20px;">
      <div class="topbar">
        <div>
          <h2 id="currentViewTitle" class="text-lg font-semibold">Dashboard</h2>
          <div id="subtitle" class="label-muted small">Welcome</div>
        </div>
        <div class="flex items-center gap-3">
          <div id="userBadge" class="small label-muted"></div>
        </div>
      </div>
      <div id="content" style="margin-top:18px;"></div>
    </main>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";
    import { getFirestore, collection, doc, getDocs, setDoc, updateDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore.js";

    const firebaseConfig = { apiKey:"YOUR_API_KEY_HERE", authDomain:"YOUR_AUTH_DOMAIN", projectId:"copinha10anos" };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    let currentUser = null;
    let users = [], schools = [];

    const loginScreen = document.getElementById('loginScreen');
    const mainApp = document.getElementById('mainApp');
    const navMenu = document.getElementById('navMenu');
    const contentEl = document.getElementById('content');
    const userBadge = document.getElementById('userBadge');

    function setupListeners(){
      onSnapshot(collection(db,'users'), snap=> users = snap.docs.map(d=>({id:d.id,...d.data()})));
      onSnapshot(collection(db,'schools'), snap=> schools = snap.docs.map(d=>({id:d.id,...d.data()})));
    }

    function renderNav(){
      navMenu.innerHTML='';
      const items=[
        {id:'dashboard',label:'Dashboard',roles:['admin','professor']},
        {id:'schools',label:'Schools',roles:['admin']},
        {id:'professors',label:'Professors',roles:['admin']}
      ];
      items.filter(it=>it.roles.includes(currentUser.profile)).forEach(it=>{
        const div=document.createElement('div');
        div.className='nav-item';
        div.textContent=it.label;
        div.onclick=()=>renderView(it.id);
        navMenu.appendChild(div);
      });
    }

    function renderView(viewId){
      document.getElementById('currentViewTitle').textContent=viewId;
      if(viewId==='schools') renderSchoolsView();
      if(viewId==='professors') renderProfessorsView();
    }

    function renderSchoolsView(){
      contentEl.innerHTML='';
      const card=document.createElement('div'); card.className='card';
      card.innerHTML=`<h3 class="font-bold">Escolas</h3><div class="mt-2">Cadastrar/editar escolas</div>`;
      const list=document.createElement('div'); list.className='mt-4';
      schools.forEach(s=>{
        const row=document.createElement('div'); row.className='py-2 border-b';
        row.innerHTML=`
          <div id="school-${s.id}" class="flex justify-between items-center">
            <span>${s.name}</span>
            <button class="btn muted-btn" onclick="editSchool('${s.id}')">Editar</button>
          </div>`;
        list.appendChild(row);
      });
      card.appendChild(list);
      card.innerHTML+=`
        <div class="mt-4">
          <input id="newSchoolName" class="input w-full" placeholder="Nova escola" />
          <button id="addSchoolBtn" class="btn btn-primary mt-2">Adicionar Escola</button>
        </div>`;
      contentEl.appendChild(card);

      document.getElementById('addSchoolBtn').onclick=async()=>{
        const name=document.getElementById('newSchoolName').value.trim();
        if(!name) return;
        const id='s'+Date.now();
        await setDoc(doc(db,'schools',id),{name});
      };
    }

    window.editSchool=function(id){
      const s=schools.find(x=>x.id===id);
      const row=document.getElementById('school-'+id);
      row.innerHTML=`
        <input id="editInput-${id}" class="input w-full" value="${s.name}" />
        <button class="btn btn-primary ml-2" onclick="saveSchool('${id}')">Salvar</button>`;
    }
    window.saveSchool=async function(id){
      const newName=document.getElementById('editInput-'+id).value.trim();
      if(newName) await updateDoc(doc(db,'schools',id),{name:newName});
    }

    function renderProfessorsView(){
      contentEl.innerHTML='';
      const card=document.createElement('div'); card.className='card';
      card.innerHTML=`<h3 class="font-bold">Professores</h3><div class="mt-2">Gerencie senhas e escolas</div>`;
      users.filter(u=>u.profile==='professor').forEach(p=>{
        const div=document.createElement('div'); div.className="card mt-3";
        div.innerHTML=`
          <h4 class="font-semibold">${p.username}</h4>
          <label class="block mt-2 small">Senha</label>
          <input id="pass-${p.id}" class="input w-full" value="${p.password||''}" />
          <label class="block mt-3 small">Escolas</label>
          <div id="schools-${p.id}" class="grid grid-cols-2 gap-2 mt-2">
            ${schools.map(s=>`
              <label class="flex items-center gap-2">
                <input type="checkbox" value="${s.id}" ${p.schoolIds?.includes(s.id)?"checked":""}/>
                ${s.name}
              </label>`).join('')}
          </div>
          <button class="btn btn-primary mt-3" onclick="saveProfessor('${p.id}')">Salvar</button>
        `;
        card.appendChild(div);
      });
      contentEl.appendChild(card);
    }

    window.saveProfessor=async function(profId){
      const pass=document.getElementById('pass-'+profId).value.trim();
      const checks=[...document.querySelectorAll(`#schools-${profId} input[type=checkbox]:checked`)];
      const schoolIds=checks.map(c=>c.value);
      await updateDoc(doc(db,'users',profId),{password:pass,schoolIds});
    }

    document.getElementById('loginBtn').onclick=async()=>{
      const username=document.getElementById('usernameInput').value.trim();
      const password=document.getElementById('passwordInput').value.trim();
      const profile=document.getElementById('profileSelect').value;
      const snap=await getDocs(collection(db,'users'));
      const allUsers=snap.docs.map(d=>({id:d.id,...d.data()}));
      const match=allUsers.find(u=>u.username===username && u.password===password && u.profile===profile);
      if(match){
        currentUser=match;
        launchAppUI();
      } else alert('Credenciais inválidas');
    };

    document.getElementById('visitorBtn').onclick=()=>{
      currentUser={username:'Visitor',profile:'visitor',schoolIds:[]};
      launchAppUI();
    };
    document.getElementById('logoutBtn').onclick=()=>{
      currentUser=null;
      mainApp.classList.add('hidden');
      loginScreen.classList.remove('hidden');
    };

    function launchAppUI(){
      loginScreen.classList.add('hidden');
      mainApp.classList.remove('hidden');
      userBadge.textContent=`${currentUser.username} (${currentUser.profile})`;
      renderNav();
      renderView('dashboard');
    }

    setupListeners();
  </script>
</body>
</html>

