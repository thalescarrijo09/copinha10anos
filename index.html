<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Gestor Municipal - Copa das Escolas (Protótipo)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root{
      --blue-dark:#002F6C;
      --blue-mid:#005EB8;
      --white:#FFFFFF;
      --green:#16A34A;
      --muted:#6b7280;
    }
    body { font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background:#f3f4f6; color:#111827; }
    .sidebar { width:260px; background:var(--blue-dark); color:var(--white); min-height:100vh; padding:20px; }
    .nav-item { padding:10px 12px; border-radius:8px; cursor:pointer; margin-bottom:8px; display:flex; align-items:center; gap:8px; }
    .nav-item:hover { background:var(--blue-mid); }
    .btn { padding:8px 12px; border-radius:8px; font-weight:600; cursor:pointer; }
    .btn-primary { background:var(--blue-dark); color:var(--white); }
    .btn-primary:hover { background:var(--blue-mid); }
    .btn-accent { background:var(--green); color:var(--white); }
    .card { background:#fff; border-radius:12px; padding:18px; box-shadow:0 6px 18px rgba(2,6,23,0.06); }
    .label-muted { color:var(--muted); font-size:0.9rem; }
    .topbar { background:var(--white); padding:12px 18px; display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #e5e7eb; }
    .logo { height:56px; }
    .input { padding:8px 10px; border-radius:8px; border:1px solid #d1d5db; }
    .muted-btn { background:#f3f4f6; color:#374151; border:1px solid #e5e7eb; }
    .small { font-size:0.85rem; color:#374151; }
    .table { width:100%; border-collapse: collapse; }
    .table th, .table td { padding:8px 10px; border-bottom:1px solid #e5e7eb; text-align:left; }
    .badge { padding:4px 8px; border-radius:8px; font-weight:600; font-size:0.75rem; }
    .status-agendado { background:#e0f2fe; color:#0369a1; }
    .status-andamento { background:#fff7ed; color:#b45309; }
    .status-encerrado { background:#ecfeef; color:#166534; }
    .focus-ring:focus { outline: 3px solid rgba(2,6,23,0.08); }
    .overflow-x { overflow-x:auto; }
    .muted-small { color:#6b7280; font-size:0.85rem; }
    .toast { position:fixed; right:20px; bottom:20px; z-index:60; }
  </style>
</head>
<body>

  <!-- Top-level notes:
    - Protótipo front-end usando localStorage (db key: gms_db)
    - Seeds: competicoes, escolas, professores (senhas Trocar123!), admin admin/TrocarAdmin123!
    - Use como sandbox para validar UX e fluxos; depois migrar para backend real.
  -->

  <div id="appRoot" class="min-h-screen flex">
    <!-- Sidebar -->
    <aside id="sidebar" class="sidebar hidden md:block">
      <div class="flex flex-col items-center mb-6">
        <img src="https://i.imgur.com/k4LX9l8.jpeg" alt="logo" style="height:72px; border-radius:8px;"/>
        <h3 class="mt-2 font-bold text-white text-center">Copa das Escolas</h3>
      </div>
      <div id="navMenu" class="mb-6"></div>
      <div style="margin-top:auto">
        <div id="userInfo" class="text-sm label-muted mb-3 px-2"></div>
        <button id="logoutBtn" class="btn" style="width:100%; background:#ef4444; color:white;">Sair</button>
      </div>
    </aside>

    <!-- Main -->
    <main id="main" class="flex-1 p-4">
      <!-- Topbar mobile -->
      <div class="md:hidden mb-4 flex items-center justify-between">
        <div>
          <h2 id="mobileTitle" class="text-lg font-semibold">Copa das Escolas</h2>
          <div id="mobileSubtitle" class="label-muted small">Sistema protótipo</div>
        </div>
        <div>
          <button id="openMenuBtn" class="btn muted-btn">Menu</button>
        </div>
      </div>

      <!-- Header / Landing -->
      <div id="header" class="card mb-4">
        <div class="flex flex-col md:flex-row md:justify-between md:items-center gap-3">
          <div>
            <h1 class="text-2xl font-bold">Gestor Municipal de Campeonatos Escolares</h1>
            <p class="label-muted mt-1">Visualize jogos, resultados e administre competições, escolas e professores.</p>
          </div>
          <div class="flex gap-2">
            <button id="visitanteBtn" class="btn btn-primary">Entrar como Visitante</button>
            <button id="loginProfessorBtn" class="btn muted-btn">Login Professor</button>
            <button id="loginAdmBtn" class="btn muted-btn">Login ADM</button>
          </div>
        </div>
      </div>

      <!-- Content area -->
      <div id="contentArea"></div>

      <!-- Toast area -->
      <div id="toastArea" class="toast"></div>
    </main>
  </div>

  <!-- Modal container (inline panels, no native alert/prompt) -->
  <div id="modalRoot" class="hidden fixed inset-0 bg-black/40 flex items-start justify-center z-50 pt-12 px-4">
    <div id="modalContent" class="card w-full max-w-2xl"></div>
  </div>

  <script>
  (function(){

    /**************************************************************
     * Protótipo front-end: DB em localStorage
     * Chave: 'gms_db'
     **************************************************************/
    const DB_KEY = 'gms_db_v1';

    /**************************************************************
     * Seed inicial (usar exatamente os valores fornecidos)
     **************************************************************/
    const SEED = {
      competicoes: [
        { id: 'c1', titulo: 'FUTSAL MASCULINO SUB -11', modalidade: 'Futsal', genero: 'Masculino', subCategoria: 'SUB-11', status: 'Planejada' },
        { id: 'c2', titulo: 'FUTSAL MASCULINO SUB -09', modalidade: 'Futsal', genero: 'Masculino', subCategoria: 'SUB-09', status: 'Planejada' },
        { id: 'c3', titulo: 'FUTSAL FEMININO SUB -11', modalidade: 'Futsal', genero: 'Feminino', subCategoria: 'SUB-11', status: 'Planejada' },
        { id: 'c4', titulo: 'QUEIMADA MASCULINO SUB -11', modalidade: 'Queimada', genero: 'Masculino', subCategoria: 'SUB-11', status: 'Planejada' },
        { id: 'c5', titulo: 'QUEIMADA FEMININO SUB -09', modalidade: 'Queimada', genero: 'Feminino', subCategoria: 'SUB-09', status: 'Planejada' },
        { id: 'c6', titulo: 'QUEIMADA FEMININO SUB -11', modalidade: 'Queimada', genero: 'Feminino', subCategoria: 'SUB-11', status: 'Planejada' },
      ],
      escolas: [
        { id: 's1', nome: 'Escola Municipal Professor Juarez Távora de Carvalho' },
        { id: 's2', nome: 'Escola Municipal Maria Aparecida de Almeida Paniago' },
        { id: 's3', nome: 'Escola Municipal Padre Maximino Alvarez Gutierrez' },
        { id: 's4', nome: 'Escola Municipal Dom Bosco' },
        { id: 's5', nome: 'Escola Municipal Tonico Corredeira' },
        { id: 's6', nome: 'Escola Municipal Santo Antônio' },
        { id: 's7', nome: 'Escola Municipal Professor Salviano Neves Amorim' },
        { id: 's8', nome: 'Escola Municipal Otalecio Alves Irineu' },
        { id: 's9', nome: 'Escola Municipal Maria Eduarda Condinho Filgueiras' },
        { id: 's10', nome: 'Escola Municipal Elias Carrijo de Sousa' },
      ],
      professores: [
        // criar usernames derivados sem acento, senhas temporárias "Trocar123!"
        { id: 'u1', nome: 'Cristiane Alves', username: 'cristianealves', password: 'Trocar123!', escolas: [], ativo: true },
        { id: 'u2', nome: 'Lindonei Junior', username: 'lindoneijunior', password: 'Trocar123!', escolas: [], ativo: true },
        { id: 'u3', nome: 'Alberto', username: 'alberto', password: 'Trocar123!', escolas: [], ativo: true },
        { id: 'u4', nome: 'Ana Mireile', username: 'anamireile', password: 'Trocar123!', escolas: [], ativo: true },
        { id: 'u5', nome: 'Daiana', username: 'daiana', password: 'Trocar123!', escolas: [], ativo: true },
        { id: 'u6', nome: 'Domingos', username: 'domingos', password: 'Trocar123!', escolas: [], ativo: true },
        { id: 'u7', nome: 'Hugo', username: 'hugo', password: 'Trocar123!', escolas: [], ativo: true },
        { id: 'u8', nome: 'Lorena', username: 'lorena', password: 'Trocar123!', escolas: [], ativo: true },
        { id: 'u9', nome: 'Poliane Vilela', username: 'polianevilela', password: 'Trocar123!', escolas: [], ativo: true },
        { id: 'u10', nome: 'Ana Paula', username: 'anapaula', password: 'Trocar123!', escolas: [], ativo: true },
        { id: 'u11', nome: 'Fernando Shoenberger Machado', username: 'fernandoshoenbergermachado', password: 'Trocar123!', escolas: [], ativo: true },
        { id: 'u12', nome: 'MArianny', username: 'marianny', password: 'Trocar123!', escolas: [], ativo: true },
      ],
      // times, atletas, jogos, recursos e auditoria começam vazios
      times: [],
      atletas: [],
      jogos: [],
      participacoes: [],
      recursos: [],
      auditoria: [],
      admins: [
        { id: 'admin1', username: 'admin', password: 'TrocarAdmin123!' }
      ]
    };

    /**************************************************************
     * Utilitários DB
     **************************************************************/
    function loadDB(){
      const raw = localStorage.getItem(DB_KEY);
      if (!raw) {
        const db = JSON.parse(JSON.stringify(SEED));
        db._createdAt = new Date().toISOString();
        localStorage.setItem(DB_KEY, JSON.stringify(db));
        return db;
      }
      return JSON.parse(raw);
    }
    function saveDB(db){
      db._updatedAt = new Date().toISOString();
      localStorage.setItem(DB_KEY, JSON.stringify(db));
    }
    function resetAndSeed(){
      localStorage.removeItem(DB_KEY);
      return loadDB();
    }

    // simple audit
    function audit({ userId=null, role='VISITANTE', acao, entidade, entidadeId=null, payload={} }){
      const db = loadDB();
      const rec = { id: 'a' + Date.now(), userId, role, acao, entidade, entidadeId, payloadJson: JSON.stringify(payload), createdAt: new Date().toISOString() };
      db.auditoria = db.auditoria || [];
      db.auditoria.push(rec);
      saveDB(db);
      showToast('Ação registrada: ' + acao);
    }

    /**************************************************************
     * Estado da sessão
     **************************************************************/
    let SESSION = { user: null, role: 'VISITANTE' }; // role: VISITANTE | PROFESSOR | ADM

    /**************************************************************
     * UI helpers
     **************************************************************/
    const contentArea = document.getElementById('contentArea');
    const navMenu = document.getElementById('navMenu');
    const userInfo = document.getElementById('userInfo');
    const modalRoot = document.getElementById('modalRoot');
    const modalContent = document.getElementById('modalContent');
    const toastArea = document.getElementById('toastArea');

    function clearContent(){ contentArea.innerHTML = ''; }
    function showToast(msg, ms=3000){
      const id = 't'+Date.now();
      const el = document.createElement('div');
      el.id = id;
      el.className = 'card p-3 mb-2';
      el.style.minWidth = '220px';
      el.textContent = msg;
      toastArea.appendChild(el);
      setTimeout(()=>{ const e = document.getElementById(id); if(e) e.remove(); }, ms);
    }

    function openModal(html){
      modalContent.innerHTML = html;
      modalRoot.classList.remove('hidden');
    }
    function closeModal(){ modalRoot.classList.add('hidden'); modalContent.innerHTML=''; }

    // small confirm modal (no native confirm)
    function confirmModal(title, message, onYes){
      openModal(`
        <h3 class="font-bold">${title}</h3>
        <p class="label-muted mt-2">${message}</p>
        <div class="mt-4 flex justify-end gap-2">
          <button id="modalNo" class="btn muted-btn">Cancelar</button>
          <button id="modalYes" class="btn btn-accent">Confirmar</button>
        </div>
      `);
      document.getElementById('modalNo').onclick = closeModal;
      document.getElementById('modalYes').onclick = ()=>{ onYes(); closeModal(); };
    }

    /**************************************************************
     * Navbar e views rendering
     **************************************************************/
    function renderNav(){
      // items visible based on ROLE
      const items = [
        { id:'home', label:'Início', roles:['VISITANTE','PROFESSOR','ADM'] },
        { id:'competicoes', label:'Competições', roles:['VISITANTE','PROFESSOR','ADM'] },
        { id:'jogos', label:'Jogos', roles:['VISITANTE','PROFESSOR','ADM'] },
        { id:'resultados', label:'Resultados', roles:['VISITANTE','PROFESSOR','ADM'] },
        { id:'classificacao', label:'Classificação', roles:['VISITANTE','PROFESSOR','ADM'] },
        { id:'escolas', label:'Escolas', roles:['VISITANTE','PROFESSOR','ADM'] },
      ];
      if (SESSION.role === 'PROFESSOR') {
        items.push({ id:'meus-times', label:'Meus Times', roles:['PROFESSOR'] });
        items.push({ id:'meus-jogos', label:'Meus Jogos', roles:['PROFESSOR'] });
      }
      if (SESSION.role === 'ADM') {
        items.push({ id:'admin', label:'Painel ADM', roles:['ADM'] });
        items.push({ id:'admin-recursos', label:'Recursos (ADM)', roles:['ADM'] });
        items.push({ id:'admin-professores', label:'Professores (ADM)', roles:['ADM'] });
      }
      navMenu.innerHTML = '';
      items.forEach(it=>{
        if (it.roles.includes(SESSION.role)) {
          const d = document.createElement('div');
          d.className = 'nav-item';
          d.textContent = it.label;
          d.onclick = ()=> routeTo(it.id);
          navMenu.appendChild(d);
        }
      });

      // mobile menu button handling
      document.getElementById('openMenuBtn').onclick = ()=>{
        // toggle sidebar on small screens
        document.querySelector('.sidebar').classList.toggle('hidden');
      };

      // user info
      if (SESSION.role === 'VISITANTE') userInfo.textContent = 'Visitante (anônimo)';
      else if (SESSION.role === 'PROFESSOR') userInfo.textContent = `${SESSION.user.nome} — Professor`;
      else if (SESSION.role === 'ADM') userInfo.textContent = `${SESSION.user.username} — ADM`;
    }

    function routeTo(route){
      const routes = {
        'home': renderHome,
        'competicoes': renderCompeticoes,
        'jogos': renderJogos,
        'resultados': renderResultados,
        'classificacao': renderClassificacao,
        'escolas': renderEscolasPublic,
        'meus-times': renderMeusTimes,
        'meus-jogos': renderMeusJogos,
        'admin': renderAdminDashboard,
        'admin-recursos': renderAdminRecursos,
        'admin-professores': renderAdminProfessores,
      };
      const fn = routes[route];
      if (fn) fn();
      window.scrollTo(0,0);
    }

    /**************************************************************
     * Views: HOME / Competicoes / Jogos / Resultados / Classificacao
     **************************************************************/
    function renderHome(){
      clearContent();
      const db = loadDB();
      const html = document.createElement('div');
      html.className = 'grid gap-4';
      html.innerHTML = `
        <div class="card">
          <h3 class="font-bold">Bem-vindo${SESSION.role !== 'VISITANTE' ? ', ' + (SESSION.user?.nome || SESSION.user?.username) : ''}</h3>
          <p class="label-muted mt-2">Modo: ${SESSION.role === 'VISITANTE' ? 'Visitante' : SESSION.role === 'PROFESSOR' ? 'Professor' : 'Administrador (ADM)' }.</p>
        </div>
        <div class="card">
          <h4 class="font-semibold">Competições disponíveis</h4>
          <div class="mt-2">${db.competicoes.map(c=>`<div class="py-1"><strong>${c.titulo}</strong> — ${c.modalidade} • ${c.genero} • ${c.subCategoria} <span class="label-muted">(${c.status})</span></div>`).join('')}</div>
        </div>
      `;
      contentArea.appendChild(html);
    }

    function renderCompeticoes(){
      clearContent();
      const db = loadDB();
      const wrap = document.createElement('div');
      wrap.className = 'card';
      wrap.innerHTML = `<h3 class="font-bold">Competições</h3><p class="label-muted mt-2">Filtre por modalidade, gênero ou subcategoria</p>`;
      // filters
      const filt = document.createElement('div'); filt.className='mt-4 flex gap-2 items-end';
      filt.innerHTML = `
        <div><label class="small">Modalidade</label><select id="fModalidade" class="input"><option value="">Todas</option><option>Futsal</option><option>Queimada</option></select></div>
        <div><label class="small">Gênero</label><select id="fGenero" class="input"><option value="">Todos</option><option>Masculino</option><option>Feminino</option></select></div>
        <div><label class="small">SubCategoria</label><select id="fSub" class="input"><option value="">Todas</option><option>SUB-09</option><option>SUB-11</option></select></div>
        <div><button id="filtrarBtn" class="btn btn-primary">Filtrar</button></div>
      `;
      wrap.appendChild(filt);

      const listWrap = document.createElement('div'); listWrap.className='mt-4 overflow-x';
      wrap.appendChild(listWrap);
      contentArea.appendChild(wrap);

      function drawList(filter={}){
        const comps = db.competicoes.filter(c=>{
          if (filter.modalidade && c.modalidade!==filter.modalidade) return false;
          if (filter.genero && c.genero!==filter.genero) return false;
          if (filter.sub && c.subCategoria!==filter.sub) return false;
          return true;
        });
        if (comps.length===0) {
          listWrap.innerHTML = '<div class="label-muted">Nenhuma competição encontrada.</div>';
          return;
        }
        listWrap.innerHTML = `<table class="table"><thead><tr><th>Competição</th><th>Modalidade</th><th>Gênero</th><th>SubCategoria</th><th>Status</th><th>Ações</th></tr></thead><tbody>
          ${comps.map(c=>`<tr>
            <td>${c.titulo}</td>
            <td>${c.modalidade}</td>
            <td>${c.genero}</td>
            <td>${c.subCategoria}</td>
            <td>${c.status}</td>
            <td><button class="btn muted-btn" data-id="${c.id}" onclick="viewCompeticao('${c.id}')">Ver</button></td>
          </tr>`).join('')}
        </tbody></table>`;
      }
      drawList();

      document.getElementById('filtrarBtn').onclick = ()=>{
        const filter = { modalidade: document.getElementById('fModalidade').value, genero: document.getElementById('fGenero').value, sub: document.getElementById('fSub').value };
        drawList(filter);
      };
    }

    // view single competition (basic)
    window.viewCompeticao = function(id){
      const db = loadDB();
      const c = db.competicoes.find(x=>x.id===id);
      if (!c) return showToast('Competição não encontrada');
      openModal(`
        <h3 class="font-bold">${c.titulo}</h3>
        <p class="label-muted mt-1">${c.modalidade} • ${c.genero} • ${c.subCategoria}</p>
        <div class="mt-3">
          <strong>Times cadastrados:</strong>
          <div class="mt-2">${db.times.filter(t=>t.competicaoId===c.id).map(t=>`<div>${t.nome} <span class="muted-small">(${getEscolaName(t.escolaId)})</span></div>`).join('') || '<div class="label-muted">Nenhum time</div>'}</div>
        </div>
        <div class="mt-4 flex justify-end"><button id="closeC" class="btn muted-btn">Fechar</button></div>
      `);
      document.getElementById('closeC').onclick = closeModal;
    };

    function getEscolaName(id){ const db=loadDB(); const e=db.escolas.find(x=>x.id===id); return e?e.nome:'-'; }
    function getProfName(id){ const db=loadDB(); const p=db.professores.find(x=>x.id===id); return p? p.nome : '-'; }

    function renderJogos(){
      clearContent();
      const db = loadDB();
      const wrap = document.createElement('div'); wrap.className='card';
      wrap.innerHTML = `<h3 class="font-bold">Jogos</h3><p class="label-muted mt-2">Lista de jogos (filtre por competição ou escola)</p>`;

      const filt = document.createElement('div'); filt.className='mt-3 flex gap-2 items-end';
      filt.innerHTML = `
        <div><label class="small">Competição</label><select id="fjCompet" class="input"><option value="">Todas</option>${db.competicoes.map(c=>`<option value="${c.id}">${c.titulo}</option>`).join('')}</select></div>
        <div><label class="small">Escola</label><select id="fjEscola" class="input"><option value="">Todas</option>${db.escolas.map(s=>`<option value="${s.id}">${s.nome}</option>`).join('')}</select></div>
        <div><button id="filtrarJogos" class="btn btn-primary">Filtrar</button></div>
      `;
      wrap.appendChild(filt);

      const listWrap = document.createElement('div'); listWrap.className='mt-4 overflow-x';
      wrap.appendChild(listWrap);
      contentArea.appendChild(wrap);

      function draw(filter={}){
        let jogos = db.jogos.slice().sort((a,b)=> new Date(a.dataHora) - new Date(b.dataHora));
        if (filter.competicao) jogos = jogos.filter(j=>j.competicaoId===filter.competicao);
        if (filter.escola) {
          // keep games where home or away team belongs to that school
          const escolaTeams = db.times.filter(t=>t.escolaId===filter.escola).map(t=>t.id);
          jogos = jogos.filter(j=>escolaTeams.includes(j.timeCasaId) || escolaTeams.includes(j.timeForaId));
        }
        if (jogos.length===0) { listWrap.innerHTML = '<div class="label-muted">Nenhum jogo encontrado.</div>'; return; }

        listWrap.innerHTML = `<table class="table"><thead><tr><th>Data</th><

